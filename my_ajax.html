<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AJAX CRUD ì‹¤ìŠµ (Vercel)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container my-4">
  <h1 class="mb-4">âš½ ì„ ìˆ˜ ê´€ë¦¬ (AJAX + Serverless)</h1>

  <form id="playerForm" class="row g-3 mb-4">
    <input type="hidden" id="playerId" />
    <div class="col-md-4">
      <input type="text" id="name" class="form-control" placeholder="ì´ë¦„" required />
    </div>
    <div class="col-md-3">
      <input type="text" id="position" class="form-control" placeholder="í¬ì§€ì…˜ (GK/DF/MF/FW)" required />
    </div>
    <div class="col-md-3">
      <input type="text" id="nation" class="form-control" placeholder="êµ­ì " required />
    </div>
    <div class="col-md-2">
      <input type="number" id="salary" class="form-control" placeholder="ì—°ë´‰ (â‚¬)" required />
    </div>
    <div class="col-12">
      <button type="submit" class="btn btn-primary">ì €ì¥</button>
      <button type="button" class="btn btn-secondary" id="cancelEdit">ì·¨ì†Œ</button>
    </div>
  </form>

  <table class="table table-striped" id="playerTable">
    <thead>
      <tr>
        <th>ID</th><th>ì´ë¦„</th><th>í¬ì§€ì…˜</th><th>êµ­ì </th><th>ì—°ë´‰</th><th>ì•¡ì…˜</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = "/api/players"; 
    const tableBody = document.querySelector("#playerTable tbody");
    const form = document.getElementById("playerForm");
    const cancelBtn = document.getElementById("cancelEdit");

    async function loadPlayers() {
      const res = await fetch(API_URL);
      const players = await res.json();
      tableBody.innerHTML = players.map(p => `
        <tr>
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${p.position}</td>
          <td>${p.nation}</td>
          <td>${p.salary.toLocaleString()}</td>
          <td>
            <button class="btn btn-sm btn-warning" onclick="editPlayer(${p.id})">ìˆ˜ì •</button>
            <button class="btn btn-sm btn-danger" onclick="deletePlayer(${p.id})">ì‚­ì œ</button>
          </td>
        </tr>
      `).join("");
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("playerId").value;
      const player = {
        id: id ? Number(id) : undefined,
        name: document.getElementById("name").value.trim(),
        position: document.getElementById("position").value.trim(),
        nation: document.getElementById("nation").value.trim(),
        salary: Number(document.getElementById("salary").value)
      };

      const method = id ? "PUT" : "POST";
      await fetch(API_URL, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(player)
      });
      alert(id ? "âœ… ìˆ˜ì • ì™„ë£Œ!" : "âœ… ì¶”ê°€ ì™„ë£Œ!");
      form.reset();
      document.getElementById("playerId").value = "";
      loadPlayers();
    });

    async function deletePlayer(id) {
      if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      await fetch(`${API_URL}?id=${id}`, { method: "DELETE" });
      alert("ğŸ—‘ï¸ ì‚­ì œ ì™„ë£Œ!");
      loadPlayers();
    }

    async function editPlayer(id) {
      const res = await fetch(API_URL);
      const players = await res.json();
      const p = players.find(x => x.id === id);
      document.getElementById("playerId").value = p.id;
      document.getElementById("name").value = p.name;
      document.getElementById("position").value = p.position;
      document.getElementById("nation").value = p.nation;
      document.getElementById("salary").value = p.salary;
    }

    cancelBtn.addEventListener("click", () => {
      form.reset();
      document.getElementById("playerId").value = "";
    });

    loadPlayers();
  </script>
</body>
</html>